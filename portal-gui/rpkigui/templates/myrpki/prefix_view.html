{% extends "base.html" %}

{% block content %}
<p>Handle: <a href="/myrpki/">{{ request.session.handle }}</a>

<h1>Prefix View</h1>

<table>
    <tr> <td>Range:</td><td>{{ addr }}</td> </tr>
    {% if addr.parent %}
    <tr>
        <td>Suballocated from:</td>
        <td><a href="{{ addr.parent.get_absolute_url }}">{{ addr.parent }}</a></td>
    </tr>
    {% endif %}
    <tr>
        <td>Received from:</td>
        <td>
            {% for p in parent %}
            <a href="{{ p.get_absolute_url }}">{{ p.handle }}</a>
            {% endfor %}
        </td>
    </tr>
    <tr><td>Validity:</td><td>{{ addr.from_cert.all.0.not_before }} - {{ addr.from_cert.all.0.not_after }} </td></tr>

    {% if addr.allocated %}
    <tr><td>Allocated:</td><td><a href="{{addr.allocated.get_absolute_url}}">{{addr.allocated.handle}}</a></td></tr>
    {% endif %}
</table>

{% if addr.children.count %}
<h2>Suballocations</h2>

<ul>
{% for subaddr in addr.children.all %}
<li><a href="{{ subaddr.get_absolute_url }}">{{ subaddr }}</a>
{% endfor %}
</ul>

{% endif %}

{% if addr.roa_requests %}
<h2>ROA requests</h2>
<table style='border: solid 1px; width:100%'>
    <tr><th>ASN</th><th>Max Length</th></tr>

    {% for r in addr.roa_requests.all %}
    <tr><td style='text-align: center'>{{ r.roa.asn }}</td>
        <td style='text-align: center'>{{ r.max_length }}</td>
        <td><a href="{{ r.get_absolute_url }}/delete">delete</a></tr>
    {% endfor %}

</table>

{% endif %} <!-- roa requests -->

{% if form %}
<h2>Edit</h2>
<form method="POST" action="{{ request.get_full_path }}">
    {{ form.as_p }}
    <input type="submit">
</form>
{% endif %}

<p>Action:
<a href="{{addr.get_absolute_url}}/split">split</a> |
<a href="{{addr.get_absolute_url}}/allocate">give to child</a> |
{% if addr.is_prefix %}
<a href="{{addr.get_absolute_url}}/roa">roa</a> |
{% endif %}
<a href="{{addr.get_absolute_url}}/delete">delete</a>

{% endblock %}

{% extends "base.html" %}

{% block css %}
table { border: solid 1px; border-collapse: collapse }
th { border: solid 1px; padding: 1em }
td { border: solid 1px; text-align: center; padding-left: 1em; padding-right: 1em }
{% endblock %}

{% block content %}
<p>Handle: <a href="{% url rpki.gui.app.views.dashboard %}">{{ request.session.handle }}</a>

<h1>Prefix View</h1>

<table>
    <tr> <td>Range:</td><td>{{ addr }}</td> </tr>
    {% if addr.parent %}
    <tr>
        <td>Suballocated from:</td>
        <td><a href="{{ addr.parent.get_absolute_url }}">{{ addr.parent }}</a></td>
    </tr>
    {% endif %}
    <tr>
        <td>Received from:</td>
        <td>
            {% for p in parent %}
            <a href="{{ p.get_absolute_url }}">{{ p.handle }}</a>
            {% endfor %}
        </td>
    </tr>
    <tr><td>Validity:</td><td>{{ addr.from_cert.all.0.not_before }} - {{ addr.from_cert.all.0.not_after }} </td></tr>

    {% if addr.allocated %}
    <tr>
        <td>Allocated:</td>
        <td><a href="{{addr.allocated.get_absolute_url}}">{{ addr.allocated.handle }}</a></td>
    </tr>
    {% endif %}
</table>

{% if addr.children.count %}
<h2>Suballocations</h2>
<ul>
{% for subaddr in addr.children.all %}
    <li><a href="{{ subaddr.get_absolute_url }}">{{ subaddr }}</a>
{% endfor %}
</ul>
{% endif %} <!-- suballocations -->

{% if addr.roa_requests.count %}
<h2>ROA requests</h2>
<table>
    <tr><th>ASN</th><th>Max Length</th></tr>

    {% for r in addr.roa_requests.all %}
    <tr>
        <td>{{ r.roa.asn }}</td>
        <td>{{ r.max_length }}</td>
        <td><a href="{{ r.get_absolute_url }}/delete">delete</a></td>
    </tr>
    {% endfor %}
</table>
{% endif %} <!-- roa requests -->

{% if unallocated %}
<h2>Unallocated</h2>
<ul>
    {% for u in unallocated %}
    <li>{{ u }}
    {% endfor %}
</ul>
{% endif %}

{% if form %}
<h2>Edit</h2>
<form method="POST" action="{{ request.get_full_path }}">
    {{ form.as_p }}
    <input type="submit">
</form>
{% endif %} <!-- form -->

<p>Action:<br>
{% if not addr.allocated %}
<a href="{{addr.get_absolute_url}}/split">split</a><br>
{% endif %}
{% if not addr.roa_requests.all %}
<a href="{{addr.get_absolute_url}}/allocate">give to child</a><br>
{% endif %}
{% if addr.is_prefix and not addr.allocated %}
<a href="{{ addr.get_absolute_url }}/roa">roa</a><br>
{% endif %}
{% if not addr.allocated and addr.parent %}
<a href="{{ addr.get_absolute_url }}/delete">delete</a><br>
{% endif %}

{% endblock %}

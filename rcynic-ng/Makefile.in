# $Id$

NAME = rcynic

BIN = ${NAME}
SRC = ${NAME}.c
OBJ = ${NAME}.o

GEN = defstack.h
HDR = defasn1.h ${GEN}

CFLAGS = @CFLAGS@ -Wall -Wshadow -Wmissing-prototypes -Wmissing-declarations
LDFLAGS = @LDFLAGS@ @LD_STATIC_FLAG@
LIBS = @LIBS@

AWK = @AWK@

abs_top_srcdir	 = @abs_top_srcdir@
abs_top_builddir = @abs_top_builddir@

host_os = @host_os@

all: ${BIN}

clean:
	cd static-rsync; ${MAKE} $@
	rm -f ${BIN} ${OBJ} ${GEN}

${BIN}: ${SRC} ${HDR}
	${CC} ${CFLAGS} -o $@ ${SRC} ${LDFLAGS} ${LIBS}

defstack.h: defstack.awk
	${AWK} -f >$@ defstack.awk

test: ${BIN}
	if test -r rcynic.conf; then ./${BIN} -j 0 && echo && ./show.sh; else echo No rcynic.conf, skipping test; fi

install: ${BIN} installation-scripts/install.sh
	cd installation-scripts; host_os="${host_os}"; DESTDIR="${DESTDIR}"; . ./install.sh

uninstall deinstall:
	cd installation-scripts; host_os="${host_os}"; DESTDIR="${DESTDIR}"; . ./deinstall.sh

distclean: clean docclean
	cd static-rsync; ${MAKE} $@
	rm -f show.sh installation-scripts/linux/install.sh Makefile

tags: TAGS

TAGS: ${SRC} ${HDR}
	etags ${SRC} ${HDR}

# Doc stuff right now is just internals doc, of interest only to
# programmers.  Real doc for rcynic is still the README.  This may
# change some day.

html:
	TZ='' doxygen

pdf: html
	cd doc/latex && TZ='' ${MAKE} pdf && ln -f refman.pdf ../manual.pdf

tgz: html
	cd doc && tar -cf - html | gzip -9 >manual.tar.gz

docs: html pdf tgz

docclean:
	rm -rf doc

# $Id$

OPENSSL_DIR = ../openssl/openssl

# Disable -Werror as long as we're using OpenSSL snapshots.

CFLAGS = -g -I${OPENSSL_DIR}/include -Wall -Wshadow -Wmissing-prototypes -Wmissing-declarations
LDFLAGS = @LD_STATIC_FLAG@

# -H -Wl,-t

BIN = rcynic
OBJ = rcynic.o
LIB = ${OPENSSL_DIR}/libcrypto.a

all: ${BIN}

clean:
	rm -f ${BIN} ${OBJ}

${BIN}: ${OBJ} ${LIB} Makefile
	${CC} -g -o $@ ${OBJ} ${LIB} ${LDFLAGS}

test: ${BIN}
	if test -r rcynic.conf; then ./${BIN} -j 0 && echo && ./show.sh; else echo No rcynic.conf, skipping test; fi

install: ${BIN} scripts/install.sh
	cd scripts; . ./install.sh

doc::
	doxygen

doc::
	cd doc/latex && make pdf && ln -f refman.pdf ..

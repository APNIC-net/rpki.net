# $Id$

NAME = rcynic

BIN = ${NAME}
SRC = ${NAME}.c
OBJ = ${NAME}.o

CFLAGS = @CFLAGS@ -Wall -Wshadow -Wmissing-prototypes -Wmissing-declarations
LDFLAGS = @LDFLAGS@ @LD_STATIC_FLAG@
LIBS = @LIBS@

abs_top_srcdir	 = @abs_top_srcdir@
abs_top_builddir = @abs_top_builddir@

host_os = @host_os@

all: ${BIN}

clean:
	cd static-rsync; ${MAKE} $@
	rm -f ${BIN} ${OBJ}

${BIN}: ${SRC}
	${CC} ${CFLAGS} -o $@ ${SRC} ${LDFLAGS} ${LIBS}

test: ${BIN}
	if test -r rcynic.conf; then ./${BIN} -j 0 && echo && ./show.sh; else echo No rcynic.conf, skipping test; fi

install: ${BIN} installation-scripts/install.sh
	cd installation-scripts; . ./install.sh ${host_os}

uninstall deinstall:
	cd installation-scripts; . ./deinstall.sh ${host_os}

doc::
	doxygen

doc::
	cd doc/latex && make pdf && ln -f refman.pdf ..

distclean: clean
	cd static-rsync; ${MAKE} $@
	rm -f show.sh Makefile

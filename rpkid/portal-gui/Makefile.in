# $Id$
#
# @configure_input@

abs_top_srcdir	 = @abs_top_srcdir@
abs_top_builddir = @abs_top_builddir@
srcdir=@srcdir@
prefix=@prefix@
exec_prefix=@exec_prefix@
datarootdir=@datarootdir@
datadir=@datadir@
localstatedir=@localstatedir@
sharedstatedir=@sharedstatedir@
bindir=@bindir@
sbindir=@sbindir@
libexecdir=@libexecdir@
sysconfdir=@sysconfdir@

INSTALL = @INSTALL@

INSTDIR=${DESTDIR}$(datarootdir)/rpki
SYSCONFDIR=${DESTDIR}${sysconfdir}/rpki

# automatically built sources
BUILD=apache.conf

all: $(BUILD)

clean:
	@true

distclean: clean
	rm -f $(BUILD)
	rm -f Makefile

edit = sed \
	     -e 's|@INSTDIR[@]|$(INSTDIR)|g'

apache.conf: $(srcdir)/apache.conf.in Makefile
	$(edit) $@.in > $@

install: $(BUILD)
	${INSTALL} -d $(SYSCONFDIR)
	${INSTALL} -d $(INSTDIR)/media/css
	${INSTALL} -d $(INSTDIR)/wsgi
	${INSTALL} -m 644 apache.conf $(SYSCONFDIR)/apache.conf
	${INSTALL} -m 644 $(srcdir)/media/css/bootstrap.min.css $(INSTDIR)/media/css/bootstrap.min.css
	${INSTALL} -m 644 rpki.wsgi $(INSTDIR)/wsgi/rpki.wsgi
	# FIXME should eventually try to merge new settings?
	@if [ ! -f ${SYSCONFDIR}/settings.py ]; then \
	    ${INSTALL} -m 644 settings.py ${SYSCONFDIR}; \
	else \
	    echo "${SYSCONFDIR}/settings.py already exists, installing settings.py as ${SYSCONFDIR}/settings.py.new"; \
	    ${INSTALL} -m 644 settings.py ${SYSCONFDIR}/settings.py.new; \
	fi

deinstall uninstall:
	rm -rf $(INSTDIR)

test:
	@true

{% extends "app/app_base.html" %}
{% load app_extras %}
{% load crispy_forms_tags %}

{% block content %}
<div class='page-header'>
  <h1>{% verbose_name object %}</h1>
</div>

{% block object_detail %}
{{ object }}
{% endblock object_detail %}

{% if form %}
  <h2>{{ form_label }}<h2>

  {% if is_preview %}
  <h3>Preview</h3>
  <table class="table table-striped table-condensed">
  {% for field in form %}
  <tr>
  <th>{{ field.label }}:</th>
  <td>{{ field.data }}</td>
  </tr>
  {% endfor %}
  </table>

  <!-- <p>Security hash: {{ hash_value }}</p> -->

  <!-- this form is used by django.contrib.formtools -->
  <form action="" method="post">{% csrf_token %}
  {% for field in form %}{{ field.as_hidden }}
  {% endfor %}
  <input type="hidden" name="{{ stage_field }}" value="2" />
  <input type="hidden" name="{{ hash_field }}" value="{{ hash_value }}" />
    <div class='form-actions'>
      <input class='btn btn-primary' type="submit" value="Save" /></p>
    </div>
  </form>

  <h3>Or edit again</h3>

  {% endif %}

  <!-- this form is used by django.contrib.formtools -->
  <form method='POST' action=''>
    {% csrf_token %}
  {{ form|crispy }}

    <div class='form-actions'>
      <input class='btn btn-primary' type='submit' value='Preview'>
      <a class='btn' href='{{ object.get_absolute_url }}'>Cancel</a>
    </div>
    <input type="hidden" name="{{ stage_field }}" value="1" />
  </form>

{% else %}
  {% if confirm_delete %}
  <div class='alert alert-block alert-warning'>
    <p><strong>Please confirm</strong> that you would like to delete this object.
    <div class='alert-actions'>
      <form method='POST' action='{{ request.get_full_path }}'>
	{% csrf_token %}
	<input class='btn btn-danger' type='submit' value='Delete'/>
	<a class='btn' href='{{ object.get_absolute_url }}'>Cancel</a>
      </form>
    </div>
  </div>
  {% else %}

    {% if can_edit %}
    <a class='btn' href='{{ object.get_absolute_url }}/edit'>Edit</a>
    {% endif %}
    <a class='btn btn-danger' href='{{ object.get_absolute_url }}/delete' title='Permanently delete this object'>Delete</a>
    {% block actions %}{% endblock actions %}

  {% endif %}
{% endif %}
{% endblock content %}
